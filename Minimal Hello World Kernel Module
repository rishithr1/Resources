
second
‚∏ª

1Ô∏è‚É£ First ‚Äî What is a Kernel Module?

A kernel module is a piece of code that runs inside the Linux kernel.

Used to:
	‚Ä¢	Add drivers
	‚Ä¢	Extend kernel features
	‚Ä¢	Control hardware

File extension:

.ko  ‚Üí Kernel Object


‚∏ª

2Ô∏è‚É£ Minimal Hello World Kernel Module

Here is the simplest module possible:

#include <linux/module.h>
#include <linux/kernel.h>
#include <linux/init.h>

static int __init hello_init(void)
{
    printk(KERN_INFO "Hello World: Kernel Module Loaded\n");
    return 0;
}

static void __exit hello_exit(void)
{
    printk(KERN_INFO "Goodbye World: Kernel Module Removed\n");
}

module_init(hello_init);
module_exit(hello_exit);

MODULE_LICENSE("GPL");
MODULE_AUTHOR("Your Name");
MODULE_DESCRIPTION("A Minimal Hello World Kernel Module");

Now let‚Äôs decode every word.

‚∏ª

3Ô∏è‚É£ Header Files Explained

1Ô∏è‚É£ linux/module.h

Contains:
	‚Ä¢	Module macros
	‚Ä¢	Init/exit definitions

Needed for all modules.

‚∏ª

2Ô∏è‚É£ linux/kernel.h

Provides:
	‚Ä¢	printk() logging
	‚Ä¢	Kernel constants

‚∏ª

3Ô∏è‚É£ linux/init.h

Defines:
	‚Ä¢	__init
	‚Ä¢	__exit macros

Used for memory optimization.

‚∏ª

4Ô∏è‚É£ Init Function

static int __init hello_init(void)

Meaning:
	‚Ä¢	Runs when module loads
	‚Ä¢	Entry point of module

‚∏ª

Inside Function

printk(KERN_INFO "Hello World...");

printk = kernel version of printf.

Logs go to kernel log buffer.

‚∏ª

5Ô∏è‚É£ Exit Function

static void __exit hello_exit(void)

Runs when module unloads.

Used for:
	‚Ä¢	Cleanup
	‚Ä¢	Free memory
	‚Ä¢	Stop hardware

‚∏ª

6Ô∏è‚É£ Module Macros

module_init(hello_init);
module_exit(hello_exit);

These tell kernel:
	‚Ä¢	Which function to run at load
	‚Ä¢	Which function at unload

‚∏ª

7Ô∏è‚É£ Metadata Section

MODULE_LICENSE("GPL");
MODULE_AUTHOR("Your Name");
MODULE_DESCRIPTION("...");

Provides module info.

Important:

If license missing ‚Üí kernel marks module ‚Äútainted‚Äù.

‚∏ª

8Ô∏è‚É£ Kernel Logging Levels

printk uses severity tags:

Level	Meaning
KERN_INFO	Info log
KERN_WARNING	Warning
KERN_ERR	Error
KERN_DEBUG	Debug

Hello world uses INFO.

‚∏ª

9Ô∏è‚É£ Makefile for Kernel Module

Create file named Makefile:

obj-m += hello.o

KDIR := /lib/modules/$(shell uname -r)/build
PWD := $(shell pwd)

all:
	make -C $(KDIR) M=$(PWD) modules

clean:
	make -C $(KDIR) M=$(PWD) clean


‚∏ª

üîü Build Steps

Run:

make

Output files generated:

hello.ko
hello.o
Module.symvers

Main file = hello.ko.

‚∏ª

1Ô∏è‚É£1Ô∏è‚É£ Load Kernel Module

Insert module:

sudo insmod hello.ko


‚∏ª

1Ô∏è‚É£2Ô∏è‚É£ Verify It Loaded

Check:

lsmod | grep hello

You‚Äôll see module listed.

‚∏ª

1Ô∏è‚É£3Ô∏è‚É£ See Kernel Logs

Run:

dmesg | tail

Output:

Hello World: Kernel Module Loaded


‚∏ª

1Ô∏è‚É£4Ô∏è‚É£ Remove Module

Unload:

sudo rmmod hello

Check logs again:

Goodbye World: Kernel Module Removed


‚∏ª

1Ô∏è‚É£5Ô∏è‚É£ Execution Flow

insmod hello.ko
   ‚Üì
Kernel loads module
   ‚Üì
hello_init() runs
   ‚Üì
printk logs message
   ‚Üì
Module active
   ‚Üì
rmmod hello
   ‚Üì
hello_exit() runs


‚∏ª

1Ô∏è‚É£6Ô∏è‚É£ Real-Life Analogy üß©

Kernel = House
Module = New appliance

When you plug appliance:
	‚Ä¢	Init = Power ON
	‚Ä¢	Exit = Power OFF

‚∏ª

1Ô∏è‚É£7Ô∏è‚É£ Why This Matters in BSP / Switch Work

Real drivers extend this concept.

Instead of printing logs, they:
	‚Ä¢	Control ASIC registers
	‚Ä¢	Read EEPROM via I¬≤C
	‚Ä¢	Handle interrupts
	‚Ä¢	Manage PHY chips

Hello world = driver skeleton.

‚∏ª

1Ô∏è‚É£8Ô∏è‚É£ Kernel Space vs User Space

Hello module runs in:

üëâ Kernel space

Meaning:
	‚Ä¢	Full hardware access
	‚Ä¢	High privilege
	‚Ä¢	Crash risk if buggy

Unlike user apps.

‚∏ª

1Ô∏è‚É£9Ô∏è‚É£ Common Beginner Errors

Error	Cause
Kernel headers missing	Install build-essential
Version mismatch	Wrong kernel build dir
Permission denied	Use sudo
Tainted kernel	Missing license


‚∏ª

2Ô∏è‚É£0Ô∏è‚É£ Office Explanation

Beginner:

‚ÄúA kernel module is a loadable piece of code that runs inside Linux kernel.‚Äù

Expert:

‚ÄúKernel modules dynamically extend kernel functionality, enabling runtime driver insertion without recompiling the kernel image.‚Äù

‚∏ª

2Ô∏è‚É£1Ô∏è‚É£ Memory Shortcut

hello_init()  ‚Üí runs at load
hello_exit()  ‚Üí runs at unload
printk()      ‚Üí kernel log
.ko           ‚Üí module file


